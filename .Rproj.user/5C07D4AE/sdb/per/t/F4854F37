{
    "collab_server" : "",
    "contents" : "#output and anyais  /// SPLIT IT \n\nsetwd(\"~/Dropbox/Wharton/z Other/1 Water start up/Mesa/Mesa\")\n\n\n\n#out.put.left  --> TO DO\n\nload(\"predict_output_with_raw.RData\", verbose = TRUE)\n\nrev.multiplier <- .1*100\n\n#note --> units are in 100s of gallons....I THINK \n\n\n\n#-------------------------------------------------------------------------------------------------------\n#SD outside of the amount information\n\nmesa.sd <- apply(mesa.raw[,8:20], MARGIN = c(1), sd)\nmesa.sd <- as.data.frame(cbind(mesa.raw$PREMISES_CODE, mesa.sd))\ncolnames(mesa.sd) <- c(\"PREMISES_CODE\", \"SD_00_12\")\n\nfor(i in 1:nrow(mesa.predict)){\n  mesa.predict$SD_00_12[i] <- mesa.sd[mesa.predict$PREMISES_CODE[i]==mesa.sd$PREMISES_CODE, 2]\n}\n\nmesa.predict$DIFF <- mesa.predict$PRED_13 - mesa.predict$ACTUAL_13\nmesa.predict$N_SD <- mesa.predict$DIFF / mesa.predict$SD_00_12\n\n\n#-------------------------------------------------------------------------------------------------------\n#Outside of RMSE of the predicted value\n\nmesa.predict$N_RMSE <- mesa.predict$DIFF / comparision$RLasso\n\n#USE SD ---> GOOD CC\n#Note some issues with variablity equal to 0... there are multiple entries on each premise code ## i dont really want to evaluate right now. \n\nsort(mesa.predict$N_SD_adj, decreasing = TRUE)\n\nmesa.predict[which.max(mesa.predict$N_SD),]\n\n#clean\nmesa.predict$N_SD_adj <- mesa.predict$N_SD\nmesa.predict$N_SD_adj[mesa.predict$N_SD_adj == Inf] <- NA\n\n#great!!\nmesa.predict[which.max(mesa.predict$N_SD_adj),]\n\n#rev. \nmesa.predict$REV <- rev.multiplier * mesa.predict$DIFF\nstolen.water.mult <- mean(mesa.raw$ACTUAL_13)\nmesa.other$REV <- rev.multiplier * stolen.water.mult * (1 - apply(mesa.other[,8:20], MARGIN = c(1), sum)/((20-8)*stolen.water.mult)) #ADJ For water reported\n\nsum(mesa.predict$REV[mesa.predict$REV>0])\nsum(mesa.other$REV[mesa.other$REV>0])\n\n###\neval.key <- as.data.frame(\n  cbind(c(3,2,1,.5,0), c(\"Very likely\", \"Likely\", \"Somewhat likely\", \"Unclear\" ,\"Unlikely\"))\n)\n\n\neval <- factor(rep(NA,nrow(mesa.predict)), levels= c(\"Very likely\", \"Likely\", \"Somewhat likely\", \"Unclear\" ,\"Unlikely\"))\n\n\n\nfor(i in 1:nrow(mesa.predict)){\n  if(is.na(mesa.predict$N_SD_adj[i])){eval[i] <- eval.key[5,2]\n  }else if( mesa.predict$N_SD_adj[i] >= as.numeric(eval.key[1,1]) ) {eval[i] <- eval.key[1,2]\n  }else if( mesa.predict$N_SD_adj[i] >= as.numeric(eval.key[2,1]) ) {eval[i] <- eval.key[2,2]\n  }else if( mesa.predict$N_SD_adj[i] >= as.numeric(eval.key[3,1]) ) {eval[i] <- eval.key[3,2]\n  }else if( mesa.predict$N_SD_adj[i] >= as.numeric(eval.key[4,1]) ) {eval[i] <- eval.key[4,2]\n    }else{eval[i] <- eval.key[5,2]}\n}\n\n\nmesa.predict$classification <- eval\n\n\n\n#-------------------------------------------------------------------------------------------------------\n#Replacement proirty calssification /// Take the max (including) possitivie\nmesa.predict$REV[mesa.predict$REV<0] <- 0\nmesa.other$REV[mesa.other$REV<0] <- 0\n\n\n#-------------------------------------------------------------------------------------------------------\n#Export repaclement \n\noutput.nontheft <- c()\n\noutput.nontheft$Meter_location <- mesa.predict$PREMISES_CODE\noutput.nontheft$Error_likelihood <- mesa.predict$classification\noutput.nontheft$Unexpected_variability <- mesa.predict$DIFF\noutput.nontheft$Meter_age <- rep(\"TBD\", nrow(mesa.predict))\noutput.nontheft$Likelihood_OT_payment <- rep(\"TBD\", nrow(mesa.predict))\noutput.nontheft$Est_lost_revenue <- mesa.predict$REV\n\nwrite.csv(output.nontheft, file = \"output_broken_meter.csv\")\n\n#-------------------------------------------------------------------------------------------------------\n#Export stolen meter  \n\nhead(mesa.other)\n\noutput.theft <- c()\n\noutput.theft$Meter_location <- mesa.other$PREMISES_CODE\noutput.theft$Error_likelihood <- mesa.other$zero.class\noutput.theft$Meter_age <- rep(\"TBD\", nrow(mesa.other))\noutput.theft$Likelihood_OT_payment <- rep(\"TBD\", nrow(mesa.other))\noutput.theft$Est_lost_revenue <- mesa.other$REV\n\nwrite.csv(output.theft, file = \"output_theft.csv\")\n\n\n\n\n\n\n\n",
    "created" : 1487266771577.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2454502808",
    "id" : "F4854F37",
    "lastKnownWriteTime" : 1487621103,
    "last_content_update" : 1487621103479,
    "path" : "~/Dropbox/Wharton/z Other/1 Water start up/Mesa/Mesa/Analysis and Output.R",
    "project_path" : "Analysis and Output.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}